(()=>{var y=class{constructor(e={}){this.config=e,this.lightboxInstances=new Map}async initialize(e,i){if(typeof PhotoSwipeLightbox>"u")return console.error("PhotoSwipe Lightbox is not available"),null;let t={gallerySelector:`#${e}`,dataSource:i,pswpModule:()=>new Promise(n=>{window.PhotoSwipe?n(window.PhotoSwipe):(console.error("PhotoSwipe core module not loaded"),n(null))}),...this.config},o=new PhotoSwipeLightbox(t);return o.init(),this.lightboxInstances.set(e,o),o}destroy(){this.lightboxInstances.forEach(e=>{e&&e.destroy&&e.destroy()}),this.lightboxInstances.clear()}},p=class{constructor(e={}){this.config=e,this.instances=new Map}initialize(e,i,t){if(typeof SmartGallery>"u")return console.error("SmartGallery is not available"),null;let o={layout:t||this.config.defaultLayout||this.config.defaultlayout||"justified",gap:this.config.gap!==void 0?parseInt(this.config.gap):10,targetRowHeight:this.config.targetRowHeight!==void 0?parseInt(this.config.targetRowHeight):this.config.targetrowheight!==void 0?parseInt(this.config.targetrowheight):300,lastRowBehavior:this.config.lastRowBehavior||this.config.lastrowbehavior||"left",columnWidth:this.config.columnWidth!==void 0?parseInt(this.config.columnWidth):this.config.columnwidth!==void 0?parseInt(this.config.columnwidth):300,columns:this.config.columns!==void 0?this.config.columns:"auto",placeholderColor:"transparent",onItemClick:({index:s,event:a})=>{if(a&&a.target.closest(".layout-btn"))return;let r=e.id.replace("gallery-inner-","gallery-");this.triggerLightbox(r,s)}},n=new SmartGallery(e,o);return n.addItems(i),n.render(),this.instances.set(e.id,{gallery:n,container:e,items:i,currentLayout:o.layout}),n}switchLayout(e,i){let t=this.instances.get(e);t&&(t.gallery.destroy(),this.initialize(t.container,t.items,i))}triggerLightbox(e,i){let t=new CustomEvent("gallery:openLightbox",{detail:{galleryId:e,index:i}});window.dispatchEvent(t)}destroy(){this.instances.forEach(({gallery:e})=>{e&&e.destroy&&e.destroy()}),this.instances.clear()}},g=class{constructor(){let e=window.HUGO_GALLERY_CONFIG||{},i=e.galleryOptions||{},t=e.lightboxOptions||{};if(typeof i=="string")try{i=JSON.parse(i)}catch(o){console.error("Failed to parse galleryOptions:",o),i={}}if(typeof t=="string")try{t=JSON.parse(t)}catch(o){console.error("Failed to parse lightboxOptions:",o),t={}}this.config={gallery:e.gallery,lightbox:e.lightbox,galleryOptions:i,lightboxOptions:t},this.layoutManager=new p(this.config.galleryOptions||{}),this.lightboxManager=new y(this.config.lightboxOptions||{}),this.galleries=[],this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){this.processImages(),this.setupEventListeners()}setupEventListeners(){window.addEventListener("gallery:openLightbox",e=>{let{galleryId:i,index:t}=e.detail,o=this.galleries.find(n=>n.id===i);o&&o.lightbox&&o.lightbox.loadAndOpen(t)})}processImages(){let e=document.querySelectorAll('.image-figure[data-gallery-type="auto"]');if(e.length===0)return;this.detectImageGroups(e).forEach(async(t,o)=>{t.length>1&&this.config.gallery?await this.createGalleryGroup(t,o):this.processIndividualImages(t)})}detectImageGroups(e){let i=[],t=[];for(let o=0;o<e.length;o++){let n=e[o],s=e[o+1];t.push(n),!(s&&this.areConsecutiveByEmptyLine(n,s))&&t.length>0&&(i.push([...t]),t=[])}return t.length>0&&i.push([...t]),i}areConsecutiveByEmptyLine(e,i){let t=e.nextElementSibling;for(;t&&t!==i;){if(t.nodeType===Node.TEXT_NODE){if(t.textContent.trim()===""){t=t.nextElementSibling;continue}return!1}if(t.nodeType===Node.ELEMENT_NODE){if(t.matches(".image-figure")){t=t.nextElementSibling;continue}let o=t.tagName.toLowerCase(),n=t.textContent.trim();if(o==="p"&&n==="")return!1;if(o==="br"){t=t.nextElementSibling;continue}else if(n!=="")return!1;t=t.nextElementSibling}}return t===i}async createGalleryGroup(e,i){let t=document.createElement("div");t.className="smart-gallery-container",t.id=`gallery-${i}`;let o=this.createLayoutSwitcher(t.id);t.appendChild(o);let n=document.createElement("div");n.className="smart-gallery",n.id=`gallery-inner-${i}`,t.appendChild(n);let s=[],a=[];e.forEach(l=>{let h=l.querySelector("img"),m=l.querySelector(".image-caption");if(h){let x=l.getAttribute("data-image-src")||h.src,d=parseInt(l.getAttribute("data-image-width"))||h.naturalWidth||800,u=parseInt(l.getAttribute("data-image-height"))||h.naturalHeight||600;s.push({src:h.src,width:d,height:u,aspectRatio:d/u}),a.push({src:x,width:d,height:u,alt:h.alt||"",caption:m?m.textContent.trim():""})}});let r=e[0];r.parentNode.insertBefore(t,r),e.forEach(l=>l.remove());let c=this.config.galleryOptions?.defaultLayout||this.config.galleryOptions?.defaultlayout||"justified";this.layoutManager.initialize(n,s,c);let w=null;this.config.lightbox&&(w=await this.lightboxManager.initialize(t.id,a)),this.galleries.push({container:t,id:t.id,index:i,lightbox:w})}createLayoutSwitcher(e){let i=document.createElement("div");i.className="gallery-layout-switcher",i.innerHTML=`
      <button class="layout-btn" data-layout="justified" title="Justified Layout">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"/>
          <rect x="14" y="3" width="7" height="7"/>
          <rect x="3" y="14" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/>
        </svg>
      </button>
      <button class="layout-btn" data-layout="masonry" title="Masonry Layout">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="5"/>
          <rect x="3" y="12" width="7" height="9"/>
          <rect x="14" y="3" width="7" height="9"/>
          <rect x="14" y="16" width="7" height="5"/>
        </svg>
      </button>
      <button class="layout-btn" data-layout="grid" title="Grid Layout">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"/>
          <rect x="14" y="3" width="7" height="7"/>
          <rect x="3" y="14" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/>
        </svg>
      </button>
    `,i.querySelectorAll(".layout-btn").forEach(n=>{n.addEventListener("click",s=>{s.stopPropagation();let a=n.getAttribute("data-layout"),r=e.replace("gallery-","gallery-inner-");this.layoutManager.switchLayout(r,a),i.querySelectorAll(".layout-btn").forEach(c=>c.classList.remove("active")),n.classList.add("active")})});let t=this.config.galleryOptions?.defaultLayout||"justified",o=i.querySelector(`[data-layout="${t}"]`);return o&&o.classList.add("active"),i}processIndividualImages(e){this.config.lightbox&&e.forEach(i=>{i.classList.add("single-image");let t=i.querySelector("img"),o=i.querySelector(".image-caption");if(!t)return;let n=i.getAttribute("data-image-src")||t.src,s=parseInt(i.getAttribute("data-image-width"))||t.naturalWidth||800,a=parseInt(i.getAttribute("data-image-height"))||t.naturalHeight||600;t.style.cursor="pointer",t.addEventListener("click",()=>{let r=new PhotoSwipeLightbox({dataSource:[{src:n,width:s,height:a,alt:t.alt||"",caption:o?o.textContent.trim():""}],pswpModule:()=>new Promise(c=>{window.PhotoSwipe?c(window.PhotoSwipe):(console.error("PhotoSwipe core module not loaded"),c(null))}),...this.config.lightboxOptions});r.init(),r.loadAndOpen(0)})})}destroy(){this.layoutManager.destroy(),this.lightboxManager.destroy(),this.galleries=[]}},b=new g;window.ImageGallery=g;})();
