(()=>{var a=class{constructor(){this.container=document.getElementById("toc-container"),this.container&&(this.position=this.container.dataset.position||"center",this.headings=[],this.tocLinks=[],this.activeParam=null,this.initialized=!1,this.init())}init(){this.initialized||(this.setupElements(),this.tocLinks.length!==0&&(this.setupObserver(),this.bindEvents(),this.sideIndicator&&(this.sideIndicator.innerHTML=""),this.position==="side"&&(this.generateSideBlocks(),this.updateSideBlocks()),this.initialized=!0,this.exposeAPI()))}setupElements(){Object.assign(this,{centerDropdown:document.getElementById("toc-center-dropdown"),centerToggle:document.getElementById("toc-center-toggle"),centerTitle:document.getElementById("toc-center-title"),sideIndicator:document.getElementById("toc-side-indicator"),sideDropdown:document.getElementById("toc-side-dropdown"),sideCloseBtn:document.getElementById("toc-side-close")});let s=document.querySelectorAll("#toc-container nav#TableOfContents a"),t=[];s.forEach(e=>{this.tocLinks.push(e);try{let i=e.href.split("#"),n=decodeURIComponent(i[i.length-1]);n&&t.push(n)}catch{e.hash.substring(1)&&t.push(e.hash.substring(1))}}),t.forEach(e=>{let i=document.getElementById(e);i&&this.headings.push(i)})}setupObserver(){let s=t=>{let e=t.filter(i=>i.isIntersecting);if(e.length>0){let i=e[0];e.forEach(n=>{n.boundingClientRect.top<i.boundingClientRect.top&&(i=n)}),this.setActive(i.target.id)}};this.observer=new IntersectionObserver(s,{rootMargin:"-20% 0px -60% 0px",threshold:[0,1]}),this.headings.forEach(t=>{this.observer.observe(t)})}setActive(s){if(!s)return;this.activeParam=s;let t="#"+s,e="";this.tocLinks.forEach(i=>{let n=i.closest("li"),c="";try{let o=i.href.split("#");c=decodeURIComponent(o[o.length-1])}catch{}c===decodeURIComponent(s)?(i.classList.add("active","font-medium"),n&&n.classList.add("active"),e=i.textContent):(i.classList.remove("active","font-medium"),n&&n.classList.remove("active"))}),e&&this.centerTitle&&(this.centerTitle.textContent=e),this.position==="side"&&this.updateSideBlocks()}generateSideBlocks(){this.sideIndicator&&(this.sideIndicator.innerHTML="",this.tocLinks.forEach(s=>{let t=0,e=s.parentElement;for(;e&&e.id!=="TableOfContents";)e.tagName&&e.tagName.toLowerCase()==="ul"&&t++,e=e.parentElement;let i=document.createElement("div"),n="w-4";t===2?n="w-3":t===3?n="w-2":t>=4&&(n="w-1"),i.className=`h-1 ${n} rounded-l-full rounded-r-none transition-all duration-300 bg-muted/50 block-item hover:bg-primary/60`;let c="";try{let o=s.href.split("#");c=o[o.length-1]}catch{c=s.hash.substring(1)}i.dataset.hash=c,i.addEventListener("click",o=>{window.matchMedia("(hover: hover)").matches&&(o.stopPropagation(),this.scrollToTarget(s.hash))}),this.sideIndicator.appendChild(i)}))}updateSideBlocks(){if(!this.sideIndicator)return;this.sideIndicator.querySelectorAll(".block-item").forEach(t=>{let e=t.dataset.hash;try{e=decodeURIComponent(e)}catch{}e===decodeURIComponent(this.activeParam)?(t.classList.remove("bg-muted/50"),t.classList.add("bg-primary","scale-x-110","origin-right")):(t.classList.remove("bg-primary","scale-x-110","origin-right"),t.classList.add("bg-muted/50"))})}scrollToTarget(s){let t=s.substring(1);try{t=decodeURIComponent(t)}catch{}let e=document.getElementById(t);if(e){let i=e.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:i,behavior:"smooth"}),this.closeAll()}}bindEvents(){let s=(t,e)=>{if(!e)return;e.classList.contains("hidden")?(e.classList.remove("hidden"),e.offsetWidth,e.classList.remove("opacity-0","scale-95"),e.classList.add("opacity-100","scale-100")):(e.classList.add("opacity-0","scale-95"),e.classList.remove("opacity-100","scale-100"),setTimeout(()=>{e.classList.add("hidden")},300))};if(this.centerToggle){let t=null;this.centerToggle.addEventListener("click",e=>{e.stopPropagation(),s(this.centerToggle.parentElement,this.centerDropdown)}),this.centerToggle.parentElement.addEventListener("mouseenter",()=>{window.matchMedia("(hover: hover)").matches&&(clearTimeout(t),this.centerDropdown.classList.contains("hidden")&&s(this.centerToggle.parentElement,this.centerDropdown))}),this.centerToggle.parentElement.addEventListener("mouseleave",()=>{window.matchMedia("(hover: hover)").matches&&(t=setTimeout(()=>{this.centerDropdown.classList.contains("hidden")||s(this.centerToggle.parentElement,this.centerDropdown)},200))})}if(this.sideIndicator&&this.sideDropdown){let t=this.sideIndicator.parentElement,e=null,i=n=>{n?this.sideDropdown.classList.add("is-open"):this.sideDropdown.classList.remove("is-open")};t.addEventListener("mouseenter",()=>{window.matchMedia("(hover: hover)").matches&&(clearTimeout(e),i(!0))}),t.addEventListener("mouseleave",()=>{window.matchMedia("(hover: hover)").matches&&(e=setTimeout(()=>{i(!1)},200))}),this.sideIndicator.addEventListener("click",n=>{window.matchMedia("(hover: hover)").matches||(n.stopPropagation(),this.sideCloseBtn?.classList.add("is-touch"),this.sideDropdown.classList.toggle("is-open"))})}this.sideCloseBtn&&this.sideCloseBtn.addEventListener("click",t=>{t.stopPropagation(),this.sideDropdown&&this.sideDropdown.classList.remove("is-open")}),document.addEventListener("click",t=>{let e=!1;this.centerDropdown&&this.centerToggle&&this.centerToggle.parentElement.contains(t.target)&&(e=!0),this.sideIndicator&&this.sideDropdown&&(this.sideIndicator.parentElement.contains(t.target)||this.sideDropdown.contains(t.target))&&(e=!0),e||this.closeAll()}),this.container.addEventListener("click",t=>{let e=t.target.closest("a");e&&e.hash&&(t.preventDefault(),this.scrollToTarget(e.hash))})}closeAll(){[this.centerDropdown].forEach(s=>{s&&!s.classList.contains("hidden")&&(s.classList.add("opacity-0","scale-95"),s.classList.remove("opacity-100","scale-100"),setTimeout(()=>{s.classList.add("hidden")},300))}),this.sideDropdown&&this.sideDropdown.classList.contains("is-open")&&this.sideDropdown.classList.remove("is-open")}exposeAPI(){window.TOC={toggle:()=>{this.position==="center"&&this.centerToggle&&this.centerToggle.click()},hide:()=>this.closeAll(),initialized:!0}}};function r(){window.tocManagerInstance||(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.tocManagerInstance||(window.tocManagerInstance=new a)}):setTimeout(()=>{window.tocManagerInstance||(window.tocManagerInstance=new a)},50))}document.addEventListener("pjax:complete",()=>{window.tocManagerInstance=null,r()});r();})();
